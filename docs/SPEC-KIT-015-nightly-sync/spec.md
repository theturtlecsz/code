# Spec: Nightly Sync Drift Detector (T15)

## Context
- Branch: `feat/speckit.auto-telemetry`
- Local-memory stores Spec Kit decisions (domains like `spec-kit`, `telemetry`, `docs-ops`).
- Evidence artifacts live under `docs/SPEC-OPS-004-integrated-coder-hooks/evidence/commands/<SPEC-ID>/`.
- No existing tooling cross-checks that every evidence artifact has a matching memory entry (and vice versa).

## Objectives
1. Implement a comparison tool (`scripts/spec-kit/nightly_sync_detect.py` or Rust equivalent) that compares evidence JSON and the export generated by `code local-memory export`.
2. Provide filters for scope (all SPEC IDs vs. single SPEC ID) and output formats (human-readable + JSON).
3. Support exit codes suitable for automation (0 = clean, 1 = drift detected, other codes for errors).
4. Document remediation steps (how to add memory entries, regenerate telemetry, mark expected drift).

## Scope
- Input sources: local-memory export (`code local-memory export --output â€¦`) and evidence directories.
- Drift cases to detect:
  - Evidence exists but no corresponding memory entry.
  - Memory entry references evidence path that no longer exists.
  - Timestamps/versions mismatch beyond a configurable delta.
- Optional allowlist file for known differences (e.g., deliberate retention of historical evidence).

## Non-Goals
- Automated reconciliation (no auto-deletes or auto-adds).
- Modifying the local-memory service; operate on exported files or direct JSON access.

## Acceptance Criteria
- CLI tool returns structured drift report and appropriate exit code.
- Docs updated explaining how to schedule nightly runs and interpret output.
- SPEC tracker updated with validation evidence (sample run output).
